{% extends 'base.html' %}
{% block title %}Painel da CoordenaÃ§Ã£o - AtendePro{% endblock %}

{% block head %}
<style>
  :root {
    --coord-primary: #003366;
    --coord-secondary: #004080;
    --coord-accent: #007acc;
    --coord-light: #f0f4f8;
    --coord-lighter: #e3f2fd;
    --coord-background: #f5f7fa;
    --coord-border: #e1e8ed;
    --coord-text: #2c3e50;
    --coord-muted: #6c757d;
    --coord-success: #28a745;
    --coord-warning: #ffc107;
    --coord-danger: #dc3545;
    --coord-white: #ffffff;
  }

  .coordenacao-container {
    background: var(--coord-background);
    min-height: calc(100vh - 120px);
    padding: 0;
  }

  .coord-header {
    background: linear-gradient(135deg, var(--coord-primary) 0%, var(--coord-secondary) 100%);
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 30px;
    color: white;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 51, 102, 0.15);
  }

  .coord-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    border-radius: 50%;
  }

  .header-content {
    position: relative;
    z-index: 2;
  }

  .header-content h1 {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .header-content p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 25px;
  }

  .exec-kpis {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    position: relative;
    z-index: 2;
  }

  .exec-kpi {
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    backdrop-filter: blur(10px);
    transition: transform 0.3s ease;
  }

  .exec-kpi:hover {
    transform: translateY(-3px);
  }

  .exec-kpi-value {
    font-size: 2rem;
    font-weight: 700;
    color: white;
    line-height: 1;
    margin-bottom: 8px;
  }

  .exec-kpi-label {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .coord-layout {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
  }

  .coord-card {
    background: var(--coord-white);
    border: 1px solid var(--coord-border);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 51, 102, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .coord-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 51, 102, 0.12);
  }

  .coord-card-header {
    background: linear-gradient(135deg, var(--coord-light) 0%, var(--coord-lighter) 100%);
    border-bottom: 1px solid var(--coord-border);
    padding: 20px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .coord-card-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--coord-primary);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .coord-card-subtitle {
    font-size: 0.9rem;
    color: var(--coord-muted);
    margin-top: 4px;
  }

  .coord-card-content {
    padding: 25px;
  }

  .supervisor-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
  }

  .supervisor-item {
    background: var(--coord-light);
    border: 1px solid var(--coord-border);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
  }

  .supervisor-item:hover {
    background: var(--coord-lighter);
    border-color: var(--coord-accent);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 122, 204, 0.15);
  }

  .supervisor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 18px;
  }

  .supervisor-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--coord-primary);
  }

  .supervisor-total {
    background: var(--coord-primary);
    color: white;
    padding: 6px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .complexity-bars {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
  }

  .complexity-bar {
    text-align: center;
  }

  .complexity-label {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--coord-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
  }

  .complexity-value {
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 6px;
  }

  .complexity-basic .complexity-value {
    color: var(--coord-success);
  }

  .complexity-medium .complexity-value {
    color: var(--coord-warning);
  }

  .complexity-complex .complexity-value {
    color: var(--coord-danger);
  }

  .complexity-progress {
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
  }

  .complexity-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s ease;
  }

  .complexity-basic .complexity-fill {
    background: linear-gradient(90deg, var(--coord-success), #20c997);
  }

  .complexity-medium .complexity-fill {
    background: linear-gradient(90deg, var(--coord-warning), #ffc720);
  }

  .complexity-complex .complexity-fill {
    background: linear-gradient(90deg, var(--coord-danger), #e74c3c);
  }

  .top-agents {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .agent-rank {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 15px;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .agent-rank:hover {
    background: rgba(255, 255, 255, 0.9);
    transform: translateX(5px);
  }

  .rank-position {
    width: 28px;
    height: 28px;
    background: var(--coord-secondary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .rank-position.first {
    background: linear-gradient(135deg, #ffd700, #ffed4a);
    color: #856404;
  }

  .rank-position.second {
    background: linear-gradient(135deg, #c0c0c0, #e2e6ea);
    color: #495057;
  }

  .rank-position.third {
    background: linear-gradient(135deg, #cd7f32, #d4a574);
    color: white;
  }

  .agent-info {
    flex: 1;
  }

  .agent-name {
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--coord-text);
  }

  .agent-count {
    font-size: 0.8rem;
    color: var(--coord-muted);
  }

  .temporal-analysis {
    display: flex;
    flex-direction: column;
    gap: 25px;
  }

  .analysis-card {
    background: var(--coord-white);
    border: 1px solid var(--coord-border);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 51, 102, 0.08);
  }

  .analysis-header {
    background: linear-gradient(135deg, var(--coord-light) 0%, var(--coord-lighter) 100%);
    border-bottom: 1px solid var(--coord-border);
    padding: 15px 20px;
  }

  .analysis-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--coord-primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .analysis-content {
    padding: 20px;
  }

  .weekday-bars {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    align-items: end;
    height: 120px;
    padding: 10px 0;
  }

  .weekday-bar {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .bar-container {
    height: 80px;
    width: 20px;
    background: #f8f9fa;
    border-radius: 4px;
    position: relative;
    overflow: hidden;
  }

  .bar-fill {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(180deg, var(--coord-accent), var(--coord-secondary));
    border-radius: 4px 4px 0 0;
    transition: height 0.8s ease;
  }

  .bar-value {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--coord-primary);
    margin-bottom: 4px;
  }

  .weekday-name {
    font-size: 0.75rem;
    color: var(--coord-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .comparison-section {
    background: var(--coord-white);
    border: 1px solid var(--coord-border);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 51, 102, 0.08);
    margin-top: 20px;
  }

  .comparison-header {
    background: linear-gradient(135deg, var(--coord-light) 0%, var(--coord-lighter) 100%);
    border-bottom: 1px solid var(--coord-border);
    padding: 20px 25px;
  }

  .comparison-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--coord-primary);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .comparison-content {
    padding: 25px;
  }

  .comparison-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
  }

  .comparison-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--coord-light);
    border-radius: 10px;
    transition: all 0.3s ease;
  }

  .comparison-item:hover {
    background: var(--coord-lighter);
    transform: translateY(-2px);
  }

  .comparison-label {
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--coord-text);
  }

  .comparison-values {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .comparison-current {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--coord-primary);
  }

  .comparison-previous {
    font-size: 0.9rem;
    color: var(--coord-muted);
  }

  .comparison-change {
    font-size: 0.8rem;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 12px;
  }

  .change-positive {
    background: #d4edda;
    color: #155724;
  }

  .change-negative {
    background: #f8d7da;
    color: #721c24;
  }

  .period-selector {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  .period-btn {
    padding: 8px 16px;
    border: 1px solid var(--coord-border);
    background: white;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
  }

  .period-btn.active {
    background: var(--coord-primary);
    color: white;
    border-color: var(--coord-primary);
  }

  .period-btn:hover:not(.active) {
    background: var(--coord-light);
  }

  @media (max-width: 1200px) {
    .coord-layout {
      grid-template-columns: 1fr;
    }
    
    .exec-kpis {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .complexity-bars {
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .weekday-bars {
      gap: 5px;
    }

    .comparison-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="coordenacao-container">
  <header class="coord-header">
    <div class="header-content">
      <h1>ðŸ‘‘ Painel da CoordenaÃ§Ã£o</h1>
      <p>AnÃ¡lise de desempenho e distribuiÃ§Ã£o de equipes por supervisor</p>
      
      <div class="exec-kpis">
        <div class="exec-kpi">
          <div class="exec-kpi-value" data-target="{{ kpis.total_supervisores }}">0</div>
          <div class="exec-kpi-label">Supervisores</div>
        </div>
        <div class="exec-kpi">
          <div class="exec-kpi-value" data-target="{{ kpis.total_agentes }}">0</div>
          <div class="exec-kpi-label">Agentes</div>
        </div>
        <div class="exec-kpi">
          <div class="exec-kpi-value" data-target="{{ kpis.total_atendimentos }}">0</div>
          <div class="exec-kpi-label">Atend. {{ periodo_label }}</div>
        </div>
        <div class="exec-kpi">
          <div class="exec-kpi-value" data-target="{{ kpis.media_supervisor }}">0</div>
          <div class="exec-kpi-label">MÃ©dia/Sup</div>
        </div>
      </div>
    </div>
  </header>

  <div class="coord-layout">
    <div class="coord-card">
      <div class="coord-card-header">
        <div>
          <div class="coord-card-title">ðŸ“Š Performance por Supervisor</div>
          <div class="coord-card-subtitle">DistribuiÃ§Ã£o por complexidade e top 5 agentes</div>
        </div>
        <div class="period-selector">
          <button class="period-btn {% if periodo_atual == 7 %}active{% endif %}" data-period="7">7 dias</button>
          <button class="period-btn {% if periodo_atual == 30 %}active{% endif %}" data-period="30">30 dias</button>
          <button class="period-btn {% if periodo_atual == 90 %}active{% endif %}" data-period="90">90 dias</button>
        </div>
      </div>
      <div class="coord-card-content">
        <div class="supervisor-grid">
          {% for supervisor_data in supervisores_data %}
          <!-- Supervisor: {{ supervisor_data.supervisor.nome }} -->
          <div class="supervisor-item">
            <div class="supervisor-header">
              <div class="supervisor-name">{{ supervisor_data.supervisor.nome }}</div>
              <div class="supervisor-total">{{ supervisor_data.total_atendimentos }} atendimentos</div>
            </div>
            
            <div class="complexity-bars">
              <div class="complexity-bar complexity-basic">
                <div class="complexity-label">BÃ¡sico</div>
                <div class="complexity-value">{{ supervisor_data.complexidade.basico }}</div>
                <div class="complexity-progress">
                  {% set total = supervisor_data.total_atendimentos %}
                  {% set percentual = (supervisor_data.complexidade.basico / total * 100) if total > 0 else 0 %}
                  <div class="complexity-fill" style="width: {{ percentual }}%"></div>
                </div>
              </div>
              <div class="complexity-bar complexity-medium">
                <div class="complexity-label">MÃ©dio</div>
                <div class="complexity-value">{{ supervisor_data.complexidade.medio }}</div>
                <div class="complexity-progress">
                  {% set percentual = (supervisor_data.complexidade.medio / total * 100) if total > 0 else 0 %}
                  <div class="complexity-fill" style="width: {{ percentual }}%"></div>
                </div>
              </div>
              <div class="complexity-bar complexity-complex">
                <div class="complexity-label">Complexo</div>
                <div class="complexity-value">{{ supervisor_data.complexidade.complexo }}</div>
                <div class="complexity-progress">
                  {% set percentual = (supervisor_data.complexidade.complexo / total * 100) if total > 0 else 0 %}
                  <div class="complexity-fill" style="width: {{ percentual }}%"></div>
                </div>
              </div>
            </div>

            <div class="top-agents">
              {% for agente in supervisor_data.top_agentes %}
              <div class="agent-rank">
                <div class="rank-position {{ agente.rank_class }}">{{ agente.posicao }}</div>
                <div class="agent-info">
                  <div class="agent-name">{{ agente.nome }}</div>
                  <div class="agent-count">{{ agente.qtd_atendimentos }} atendimentos</div>
                </div>
              </div>
              {% endfor %}
              
              {% if supervisor_data.top_agentes|length == 0 %}
              <div style="text-align: center; color: var(--coord-muted); padding: 20px;">
                Nenhum atendimento no perÃ­odo
              </div>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>  <div class="agent-name">Felipe AragÃ£o</div>
                  <div class="agent-count">15 atendimentos</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="temporal-analysis">
      <div class="analysis-card">
        <div class="analysis-header">
          <div class="analysis-title">ðŸ“… Volume por Dia da Semana</div>
        </div>
        <div class="analysis-content">
          <div class="weekday-bars">
            {% for dia in volume_semanal %}
            <div class="weekday-bar">
              <div class="bar-value">{{ dia.volume }}</div>
              <div class="bar-container">
                <div class="bar-fill" style="height: {{ dia.altura_percentual }}%"></div>
              </div>
              <div class="weekday-name">{{ dia.dia_nome }}</div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="analysis-card">
        <div class="analysis-header">
          <div class="analysis-title">ðŸ“ˆ TendÃªncia de Performance</div>
        </div>
        <div class="analysis-content">
          <div style="text-align: center; color: var(--coord-muted); font-size: 0.9rem; padding: 20px;">
            {% set melhor_dia = volume_semanal|max(attribute='volume') %}
            {% set melhor_dia_nome = (volume_semanal|selectattr('volume', 'equalto', melhor_dia.volume)|first).dia_nome %}
            <p><strong>Melhor Dia:</strong> {{ melhor_dia_nome }} ({{ melhor_dia.volume }} atendimentos)</p>
            <p><strong>PerÃ­odo:</strong> {{ periodo_label }}</p>
            <p><strong>Total no PerÃ­odo:</strong> {{ kpis.total_atendimentos }} atendimentos</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="comparison-section">
    <div class="comparison-header">
      <div class="comparison-title">ðŸ“Š Comparativo {{ periodo_label }}</div>
    </div>
    <div class="comparison-content">
      <div class="comparison-grid">
        <div class="comparison-item">
          <div class="comparison-label">Total de Atendimentos</div>
          <div class="comparison-values">
            <div class="comparison-current">{{ comparativo.total_atendimentos.atual }}</div>
            <div class="comparison-previous">{{ comparativo.total_atendimentos.anterior }}</div>
            <div class="comparison-change {{ comparativo.total_atendimentos.classe }}">{{ comparativo.total_atendimentos.variacao }}</div>
          </div>
        </div>

        <div class="comparison-item">
          <div class="comparison-label">MÃ©dia por Supervisor</div>
          <div class="comparison-values">
            <div class="comparison-current">{{ comparativo.media_supervisor.atual }}</div>
            <div class="comparison-previous">{{ comparativo.media_supervisor.anterior }}</div>
            <div class="comparison-change {{ comparativo.media_supervisor.classe }}">{{ comparativo.media_supervisor.variacao }}</div>
          </div>
        </div>

        <div class="comparison-item">
          <div class="comparison-label">Casos Complexos</div>
          <div class="comparison-values">
            <div class="comparison-current">{{ comparativo.casos_complexos.atual }}</div>
            <div class="comparison-previous">{{ comparativo.casos_complexos.anterior }}</div>
            <div class="comparison-change {{ comparativo.casos_complexos.classe }}">{{ comparativo.casos_complexos.variacao }}</div>
          </div>
        </div>

        <div class="comparison-item">
          <div class="comparison-label">Taxa de ResoluÃ§Ã£o</div>
          <div class="comparison-values">
            <div class="comparison-current">{{ comparativo.taxa_resolucao.atual }}</div>
            <div class="comparison-previous">{{ comparativo.taxa_resolucao.anterior }}</div>
            <div class="comparison-change {{ comparativo.taxa_resolucao.classe }}">{{ comparativo.taxa_resolucao.variacao }}</div>
          </div>
        </div>

        <div class="comparison-item">
          <div class="comparison-label">Tempo MÃ©dio (min)</div>
          <div class="comparison-values">
            <div class="comparison-current">{{ comparativo.tempo_medio.atual }}</div>
            <div class="comparison-previous">{{ comparativo.tempo_medio.anterior }}</div>
            <div class="comparison-change {{ comparativo.tempo_medio.classe }}">{{ comparativo.tempo_medio.variacao }}</div>
          </div>
        </div>

        <div class="comparison-item">
          <div class="comparison-label">SatisfaÃ§Ã£o Cliente</div>
          <div class="comparison-values">
            <div class="comparison-current">{{ comparativo.satisfacao.atual }}</div>
            <div class="comparison-previous">{{ comparativo.satisfacao.anterior }}</div>
            <div class="comparison-change {{ comparativo.satisfacao.classe }}">{{ comparativo.satisfacao.variacao }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // AnimaÃ§Ã£o dos KPIs
  function animateKPIs() {
    const kpis = document.querySelectorAll('.exec-kpi-value');
    kpis.forEach(kpi => {
      const target = parseInt(kpi.dataset.target);
      let current = 0;
      const increment = target / 30;
      
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        kpi.textContent = Math.floor(current);
      }, 50);
    });
  }

  // AnimaÃ§Ã£o das barras
  function animateBars() {
    const bars = document.querySelectorAll('.bar-fill, .complexity-fill');
    bars.forEach((bar, index) => {
      setTimeout(() => {
        bar.style.opacity = '1';
      }, index * 100);
    });
  }

  // Sistema de filtros por perÃ­odo
  function setupPeriodFilters() {
    const periodBtns = document.querySelectorAll('.period-btn');
    
    periodBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const periodo = this.dataset.period;
        
        // Redireciona com o novo perÃ­odo
        const url = new URL(window.location);
        url.searchParams.set('periodo', periodo);
        window.location.href = url.toString();
      });
    });
  }

  // Atualiza dados baseado no perÃ­odo via AJAX
  function updateDataForPeriod(period) {
    fetch(`/api/painel_coordenacao/dados?periodo=${period}`)
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Atualiza KPIs
          const kpis = document.querySelectorAll('.exec-kpi-value');
          kpis[0].textContent = data.kpis.supervisores;
          kpis[1].textContent = data.kpis.agentes;
          kpis[2].textContent = data.kpis.atendimentos;
          kpis[3].textContent = data.kpis.media;

          // Atualiza label do perÃ­odo
          const label = period === '7' ? 'Semana' : period === '30' ? 'MÃªs' : 'Trimestre';
          kpis[2].nextElementSibling.textContent = `Atend. ${label}`;
          
          // Efeito visual de atualizaÃ§Ã£o
          kpis.forEach(kpi => {
            kpi.style.color = '#28a745';
            setTimeout(() => {
              kpi.style.color = 'white';
            }, 1000);
          });
        }
      })
      .catch(error => {
        console.error('Erro ao atualizar dados:', error);
        showAlert('Erro ao atualizar dados', 'warning');
      });
  }

  // Hover effects nos cards
  function setupHoverEffects() {
    const items = document.querySelectorAll('.supervisor-item, .agent-rank, .comparison-item');
    
    items.forEach(item => {
      item.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-3px)';
      });
      
      item.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
      });
    });
  }

  // Sistema de notificaÃ§Ãµes em tempo real
  function setupRealTimeUpdates() {
    // Simula atualizaÃ§Ãµes em tempo real
    setInterval(() => {
      // Pequenas variaÃ§Ãµes nos nÃºmeros para simular tempo real
      const kpis = document.querySelectorAll('.exec-kpi-value');
      const baseValues = [3, 24, 387, 129];
      
      kpis.forEach((kpi, index) => {
        const variation = Math.floor(Math.random() * 3) - 1; // -1, 0, ou 1
        const newValue = baseValues[index] + variation;
        
        if (newValue > 0) {
          kpi.textContent = newValue;
          
          // Efeito visual de atualizaÃ§Ã£o
          kpi.style.color = '#28a745';
          setTimeout(() => {
            kpi.style.color = 'white';
          }, 1000);
        }
      });
    }, 30000); // Atualiza a cada 30 segundos
  }

  // Sistema de alertas baseado em performance
  function setupPerformanceAlerts() {
    // Verifica se algum supervisor estÃ¡ abaixo da mÃ©dia
    const supervisors = [
      { name: 'Ana Silva', total: 134, average: 129 },
      { name: 'Roberto Fernandes', total: 108, average: 129 },
      { name: 'Mariana Oliveira', total: 145, average: 129 }
    ];

    supervisors.forEach(supervisor => {
      if (supervisor.total < supervisor.average * 0.8) {
        showAlert(`âš ï¸ ${supervisor.name} estÃ¡ com performance abaixo da mÃ©dia`, 'warning');
      }
    });
  }

  // FunÃ§Ã£o para mostrar alertas
  function showAlert(message, type = 'info') {
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${type === 'warning' ? '#fff3cd' : '#d4edda'};
      color: ${type === 'warning' ? '#856404' : '#155724'};
      border: 1px solid ${type === 'warning' ? '#ffeaa7' : '#c3e6cb'};
      border-radius: 8px;
      padding: 15px 20px;
      max-width: 300px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      z-index: 10000;
      animation: slideInRight 0.3s ease;
    `;
    alert.textContent = message;

    document.body.appendChild(alert);

    // Remove apÃ³s 5 segundos
    setTimeout(() => {
      alert.style.animation = 'slideOutRight 0.3s ease';
      setTimeout(() => alert.remove(), 300);
    }, 5000);
  }

  // Adiciona animaÃ§Ãµes CSS
  const style = document.createElement('style');
  style.textContent = `
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutRight {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
  `;
  document.head.appendChild(style);

  // Inicializa todas as funcionalidades
  animateKPIs();
  animateBars();
  setupPeriodFilters();
  setupHoverEffects();
  setupRealTimeUpdates();
  setupPerformanceAlerts();

  // Log de debug
  console.log('ðŸš€ Painel da CoordenaÃ§Ã£o carregado com sucesso!');
});

// FunÃ§Ã£o para exportar dados (pode ser chamada externamente)
window.exportCoordData = function() {
  const data = {
    timestamp: new Date().toISOString(),
    supervisors: [
      { name: 'Ana Silva', total: 134, basic: 72, medium: 45, complex: 17 },
      { name: 'Roberto Fernandes', total: 108, basic: 51, medium: 38, complex: 19 },
      { name: 'Mariana Oliveira', total: 145, basic: 82, medium: 44, complex: 19 }
    ],
    totals: {
      agents: 24,
      total_calls: 387,
      average_per_supervisor: 129
    }
  };

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `coordenacao_${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
};
</script>
{% endblock %}